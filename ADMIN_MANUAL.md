# 在席確認表 管理者マニュアル

## 目次
1. [管理者権限について](#管理者権限について)
2. [管理パネルへのアクセス](#管理パネルへのアクセス)
3. [お知らせ管理](#お知らせ管理)
4. [イベント管理](#イベント管理)
5. [CSVエクスポート](#csvエクスポート)
6. [CSVインポート](#csvインポート)
7. [拠点名の変更](#拠点名の変更)
8. [パスワード変更](#パスワード変更)
9. [メニュー設定（JSON）](#メニュー設定json)
10. [運用上の注意事項](#運用上の注意事項)
11. [トラブルシューティング](#トラブルシューティング)

---

## 管理者権限について

### 権限の種類
本システムには2つの管理者権限があります：

1. **拠点管理者（officeAdmin）**
   - 自分が所属する拠点のみを管理できます
   - ログイン時に**管理者パスワード**を使用します
   - 管理パネルで自拠点のデータのみ操作可能です

2. **スーパー管理者（superAdmin）**
   - 全拠点を管理できます
   - `admin` 拠点の管理者パスワードでログインします
   - すべての拠点の設定を変更できます

### 管理者ログイン
1. ログイン画面で拠点を選択
2. **管理者パスワード**を入力してログイン
3. ヘッダーに「管理」ボタンが表示されます

---

## 管理パネルへのアクセス

### 管理パネルを開く
1. ログイン後、ヘッダーの**「管理」**ボタンをクリック
2. 管理パネルが画面中央にモーダル表示されます
3. 操作が完了したら「閉じる」ボタンで閉じます

### 管理パネルの構成
管理パネルには以下の機能があります（タブで切り替え）：

#### 基本設定タブ
- CSVエクスポート
- CSVインポート
- 拠点名の変更
- 拠点パスワードの変更

#### お知らせ管理タブ
- お知らせの追加・編集・削除
- 表示順序の管理
- 表示/非表示の切り替え

#### イベント管理タブ
- イベントの作成・編集・削除
- ガントチャートでのメンバー指定
- 表示/非表示の切り替え

---

## お知らせ管理

### 概要
お知らせ機能を使用すると、拠点のメンバー全員に重要な情報を掲示できます。

### お知らせの表示場所
- ヘッダーとメインボードの間に**お知らせエリア**として表示されます
- お知らせがある場合のみ、ヘッダーに**「お知らせ」**ボタンが表示されます
- ユーザーはボタンをクリックして折りたたみ/展開を切り替えられます

### お知らせの追加

#### 自動読み込み機能
**管理パネルを開くと、現在のお知らせが自動的に表示されます。** 「現在のお知らせを読み込み」ボタンを押す必要はありません。

#### 操作手順
1. 管理パネルを開く（現在のお知らせが自動的に表示されます）
2. **「➕ お知らせを追加」**ボタンをクリック→ 新しい入力欄が追加されます
3. **タイトル**欄に見出しを入力（例：「システムメンテナンスのお知らせ」）
4. **内容**欄に詳細を入力（例：「明日23:00〜24:00までメンテナンスを実施します。」）
5. **「保存」**ボタンをクリック
6. 成功すると「お知らせを保存しました」というメッセージが表示されます

#### 入力制限
- **タイトル**：最大200文字
- **内容**：最大2000文字
- **最大件数**：1拠点あたり20件まで

### お知らせの編集

#### 操作手順
1. 管理パネルを開く
2. **お知らせ管理**セクションの**お知らせ一覧**を確認
3. 編集したいお知らせの**「編集」**ボタンをクリック
4. タイトル欄と内容欄に現在の値が入力されます
5. 内容を修正
6. **「追加」**ボタンをクリック（編集モード時は「更新」として動作）
7. 成功すると「お知らせを保存しました」というメッセージが表示されます

#### 編集モードのキャンセル
- **「キャンセル」**ボタンをクリックすると、編集モードが解除されます
- 入力欄がクリアされ、新規追加モードに戻ります

### お知らせの削除

#### 操作手順
1. 管理パネルを開く
2. **お知らせ管理**セクションの**お知らせ一覧**を確認
3. 削除したいお知らせの**「削除」**ボタンをクリック
4. 確認ダイアログが表示されます
5. **「OK」**をクリックすると削除されます
6. 成功すると「お知らせを保存しました」というメッセージが表示されます

### お知らせの表示順序
- お知らせは**追加した順番**（古い順）に表示されます
- 最初に追加されたお知らせが最上位に表示されます
- 編集しても順序は変わりません
- 順序を変更したい場合は、一度削除して再度追加してください

### お知らせの用途例
以下のような情報の掲示に利用できます：

- **システムメンテナンス**：「明日23:00〜24:00までシステムメンテナンスを実施します」
- **業務連絡**：「今月の全体会議は15日（金）14:00〜です」
- **重要なお願い**：「在席表の入力は9時までにお願いします」
- **新機能の案内**：「お知らせ機能が追加されました。詳細はマニュアルをご確認ください」
- **注意事項**：「台風接近のため、明日は早めの帰宅を推奨します」
- **イベント告知**：「社内レクリエーション参加者募集中（締切：今週金曜日）」

### 権限
- **拠点管理者**：自分の拠点のお知らせのみ管理可能
- **スーパー管理者**：すべての拠点のお知らせを管理可能

### ユーザー側の表示

#### 初期表示
- ログイン直後、お知らせは**展開状態**で表示されます
- すべてのお知らせのタイトルと内容が確認できます

#### 折りたたみ表示
- ヘッダーの**「お知らせ」**ボタンをクリックすると折りたたまれます
- 折りたたみ時は以下の形式で表示されます：
  ```
  最初のお知らせのタイトル (他●件)
  ```
- 例：`システムメンテナンスのお知らせ (他2件)`

#### お知らせがない場合
- お知らせエリアは表示されません
- ヘッダーの「お知らせ」ボタンも表示されません

### 注意事項

#### 1. 自動反映のタイミング
- お知らせの追加・編集・削除は、サーバーに即座に保存されます
- 全ユーザーの画面には**約30秒以内**に自動的に反映されます
- すぐに確認してほしい場合は、ユーザーにページの再読み込み（F5キー）を依頼してください

#### 2. 拠点ごとに管理
- お知らせは拠点ごとに独立して管理されます
- 名古屋拠点のお知らせは東京拠点には表示されません
- スーパー管理者のみ、他拠点のお知らせを管理できます

#### 3. HTML・スクリプトは無効化
- セキュリティのため、HTMLタグやJavaScriptは自動的に無効化されます
- 入力した内容はプレーンテキストとして表示されます

#### 4. 改行の扱い
- 内容欄での改行は、表示時にも反映されます
- 見やすいように適切に改行を入れてください

#### 5. 件数制限
- 1拠点あたり最大20件まで登録できます
- 20件を超えて追加しようとすると、古いお知らせが自動的に削除されます
- 重要なお知らせが残るよう、定期的に不要なお知らせを削除してください

#### 6. 文字数制限
- タイトル：200文字まで
- 内容：2000文字まで
- 超過した場合、自動的に切り詰められます

### トラブルシューティング

#### Q: お知らせを追加したのに表示されない
**A**：以下を確認してください：
- 管理パネルで「お知らせを保存しました」というメッセージが表示されたか
- ブラウザを再読み込み（F5）してみてください
- ブラウザのコンソール（F12 → Console）にエラーが表示されていないか確認

#### Q: お知らせが削除できない
**A**：
- 削除ボタンをクリックした後、確認ダイアログで「OK」を選択したか確認
- ページを再読み込みして再度試してください
- それでも削除できない場合、システム管理者に連絡してください

#### Q: 編集中に「キャンセル」を押したが、内容がクリアされない
**A**：
- もう一度「キャンセル」ボタンをクリックしてください
- ページを再読み込みすると、編集モードが解除されます

#### Q: お知らせの順序を変更したい
**A**：
- 現在、順序の変更機能はありません
- 順序を変更するには、該当するお知らせを削除して、希望の順序で再度追加してください

#### Q: 他の拠点のお知らせを管理したい
**A**：
- スーパー管理者権限が必要です
- スーパー管理者でログインすると、拠点選択機能が表示されます
- 拠点管理者は自分の拠点のみ管理できます

---

## イベント管理

### 概要
イベント管理機能を使用すると、GW、年末年始、夏季休暇など、複数日にわたる休暇を事前に登録・管理できます。

### イベント管理タブを開く
1. 管理パネルを開く
2. **「📅 イベント管理」**タブをクリック

### イベントの作成

#### 操作手順
1. 管理パネルの「イベント管理」タブを開く
2. 「イベントの作成 / 更新」セクションで以下を入力：

**必須項目**：
- **対象拠点**：イベントを登録する拠点（スーパー管理者の場合のみ選択）
- **タイトル**：休暇の名称（例：「GW期間休暇」「年末年始休暇」）
- **開始日**：休暇期間の開始日（カレンダーから選択）
- **終了日**：休暇期間の終了日（カレンダーから選択）

**任意項目**：
- **備考**：社内共有用のメモ（例：「今年のGWは10連休です」）
- **表示する**：チェックONでユーザーが選択可能、OFFで管理者のみ閲覧可能

3. 開始日と終了日を入力すると、**ガントチャート**が自動生成されます
4. ガントチャート上で休暇対象のメンバーと日付を指定：
   - セルをクリック：休暇のON/OFF切り替え
   - ドラッグ：連続した日付やメンバーを一度に設定
   - スマートフォンでも操作可能（タップで切り替え）
5. **「💾 作成/更新」**ボタンをクリック
6. 「イベントを保存しました」と表示されたら成功です

#### ガントチャートの使い方

**表示内容**：
- **横軸**：開始日〜終了日の各日付
- **縦軸**：グループとメンバー
- **セル**：各メンバーの各日の休暇状況（色付き＝休暇）
- **自動色分け**：土曜日（青系）、日曜・祝日（赤系）

**操作方法**：
- **クリック**：セルをクリックしてON/OFFを切り替え
- **ドラッグ**：マウスをドラッグして複数セルを一度に設定
- **タッチ**：スマートフォンではタップで操作可能

**グループジャンプ**：
- メンバーが多い場合、グループ選択ボックスで素早く移動できます
- 選択ボックスから移動先のグループを選んでください

### イベントの編集

1. 「登録済みのイベント」一覧から、編集したい項目の**「編集」**ボタンをクリック
2. 入力欄に現在の設定が表示されます
3. 必要な項目を修正します
4. ガントチャートで休暇対象メンバー・日付を変更します
5. **「💾 作成/更新」**ボタンをクリック

### イベントの削除

1. 削除したいイベントを選択（編集ボタンをクリック）
2. **「🗑️ 削除」**ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 「削除しました」と表示されたら成功です

### 表示/非表示の切り替え

「登録済みのイベント」一覧の**「表示」チェックボックス**で切り替えます：

- **チェックON**：
  - ユーザーがイベントボタンから選択・表示できます
  - 複数のイベントを同時に表示ONにできますが、ユーザーが選択できるのは1つだけです
  
- **チェックOFF**：
  - 管理者のみ閲覧可能
  - ユーザーには表示されません（イベントボタンにも出ません）
  - 準備中のイベントや過去の休暇を非表示にする際に便利です

### ユーザー側の表示

#### 初期状態
- 「表示」がONのイベントが1件以上ある場合、ヘッダーに**「イベント」**ボタンが表示されます
- イベントがない、または全て非表示の場合はボタンが表示されません

#### ユーザーの操作
1. ユーザーが「イベント」ボタンをクリック
2. 表示可能なイベントの一覧から選択
3. ガントチャートで休暇状況を確認
4. 「表示」ボタンをクリックすると、メイン画面で該当メンバーがハイライト表示されます

#### 表示内容
- 休暇中のメンバーの行が色付きでハイライトされます
- ステータス欄にイベントのタイトルが表示されます（例：「GW期間休暇」）
- 内部的には「休み」ステータスとして扱われます

### イベントの用途例

- **🎌 GW（ゴールデンウィーク）**：5月の連休期間の休暇管理
- **🎆 夏季休暇**：8月のお盆休み期間
- **🎄 年末年始休暇**：12月末〜1月初旬の休暇
- **🏢 会社全体休業日**：創立記念日などの一斉休暇
- **📅 特定チームの一斉休暇**：部署単位での休暇計画

### 注意事項

#### 1. 期間と日付の設定
- 開始日と終了日を入力しないとガントチャートが生成されません
- 開始日 > 終了日の場合、自動的に入れ替わります
- 過去の日付でも登録できます（過去の休暇記録として利用可能）

#### 2. メンバー指定
- ガントチャートでセルがONになっているメンバー・日付が休暇として扱われます
- 未指定のメンバーは通常通り表示されます
- 日付ごとに個別に休暇を設定できます（例：5/3〜5/5は全員、5/1は一部のみ）

#### 3. 自動更新
- イベントの追加・編集・削除はサーバーに即座に保存されます
- ユーザーの画面には約30秒以内に反映されます
- すぐに確認してほしい場合は、ユーザーにページの再読み込み（F5）を依頼してください

#### 4. 拠点ごとに管理
- イベントは拠点ごとに独立して管理されます
- 他拠点のイベントは表示されません
- スーパー管理者のみ、他拠点のイベントを管理できます

#### 5. 期間終了後の扱い
- イベント期間が終了しても、自動的には非表示になりません
- 管理者が手動で「表示」チェックをOFFにするか、削除してください
- 過去の記録として残しておくこともできます

#### 6. ユーザーの編集制限
- ユーザーがイベントを表示している間、該当メンバーのステータスは編集できません
- ステータスを編集したい場合は、ユーザーに「表示クリア」を依頼してください

---

## CSVエクスポート

### 用途
- 現在の名簿と在席データをCSV形式でダウンロードします
- Excelなどで編集したり、バックアップとして保存できます

### 操作手順
1. 管理パネルを開く
2. **CSVエクスポート**セクションの「ダウンロード」ボタンをクリック
3. ファイル名 `presence_<拠点ID>.csv` でダウンロードされます

### CSV形式
エクスポートされるCSVのヘッダーは以下の通りです：

```
グループ番号,グループ名,表示順,id,氏名,内線,業務時間,ステータス,戻り時間,備考
```

**各列の説明**：

| 列名 | 説明 | 例 |
|------|------|-----|
| グループ番号 | グループの番号（1から始まる連番） | 1 |
| グループ名 | グループ（チーム）の名前 | 営業部 |
| 表示順 | グループ内での表示順序（1から始まる連番） | 1 |
| id | メンバーの一意ID（自動生成） | m_abc123 |
| 氏名 | メンバーの名前 | 田中太郎 |
| 内線 | 内線番号（1〜4桁の数字） | 1234 |
| 業務時間 | 勤務時間帯 | 09:00-17:30 |
| ステータス | 現在のステータス | 在席 |
| 戻り時間 | 戻り予定時刻 | 14:00 |
| 備考 | 備考 | 直帰 |

### 注意事項
- エクスポートされるデータは**現在の最新状態**です
- CSVファイルはUTF-8（BOM付き）で出力されます（Excel対応）
- 数式インジェクション対策として、`=`、`+`、`-`、`@`、タブで始まるセルには自動的に `'` が付与されます

---

## CSVインポート

### 用途
- 名簿の一括登録・更新
- 外部で編集したデータの取り込み
- 他拠点からのデータ移行

### 操作手順
1. 管理パネルを開く
2. **CSVインポート**セクションの「ファイルを選択」をクリック
3. インポートするCSVファイルを選択
4. 「取り込み」ボタンをクリック
5. 処理完了後、「インポート完了」というメッセージが表示されます

### 対応しているCSV形式

#### 1. 標準形式（業務時間列あり）
```
グループ番号,グループ名,表示順,id,氏名,内線,業務時間,ステータス,戻り時間,備考
```
または英語ヘッダー：
```
group_index,group_title,member_order,id,name,ext,workHours,status,time,note
```

#### 2. 旧形式（業務時間列なし）
```
グループ番号,グループ名,表示順,id,氏名,内線,ステータス,戻り時間,備考
```
または英語ヘッダー：
```
group_index,group_title,member_order,id,name,ext,status,time,note
```

**旧形式の場合**：既存データから業務時間を引き継ぎます（id またはキー一致で判定）

### CSVファイル作成のルール

#### 必須列
- **グループ番号**：1以上の整数
- **グループ名**：任意の文字列（空白可）
- **表示順**：グループ内での順序（1以上の整数）
- **氏名**：空欄不可

#### 任意列
- **id**：空欄の場合は自動生成されます（推奨：空欄のままにする）
- **内線**：数字のみ（1〜4桁）、空欄可
- **業務時間**：形式は `HH:MM-HH:MM`（例：`09:00-17:30`）
- **ステータス**：設定されたステータス値のいずれか（デフォルト：在席）
- **戻り時間**：`HH:MM` 形式（例：`14:00`）
- **備考**：任意の文字列

### インポート時の動作

1. **名簿の上書き**：
   - インポートすると、現在の名簿が**完全に置き換えられます**
   - グループ構成、メンバー構成が新しいCSVの内容になります

2. **在席データの更新**：
   - CSVに含まれるステータス、戻り時間、備考が反映されます
   - **id が一致するメンバー**：そのまま更新されます
   - **id が空欄の新メンバー**：新しい id が自動生成されます
   - **CSVに含まれないメンバー**：削除されます

3. **業務時間の扱い**：
   - 標準形式（業務時間列あり）：CSVの値をそのまま使用
   - 旧形式（業務時間列なし）：既存データから業務時間を引き継ぎ

### 注意事項
- **バックアップ必須**：インポート前に必ずエクスポートでバックアップを取ってください
- **ヘッダー行必須**：1行目は必ずヘッダー行として扱われます
- **文字コード**：UTF-8（BOM付き）またはShift-JISに対応
- **大量データ**：100件以上のデータは自動的に分割処理されます
- **エラー時**：ヘッダーが不正な場合、エラーメッセージが表示され、取り込みは中止されます

---

## 拠点名の変更

### 用途
- ログイン画面や画面タイトルに表示される拠点名を変更します

### 操作手順
1. 管理パネルを開く
2. **拠点名の変更**セクションに新しい拠点名を入力
3. 「変更」ボタンをクリック
4. 成功すると「拠点名を変更しました」というメッセージが表示されます

### 注意事項
- 拠点名は空欄にできません
- 変更は即座に反映されます
- 他の管理者やユーザーの画面にも自動的に反映されます（次回読み込み時）

---

## パスワード変更

### 用途
- **ユーザーパスワード**：一般ユーザーがログインする際のパスワード
- **管理者パスワード**：管理者権限でログインする際のパスワード

### 操作手順
1. 管理パネルを開く
2. **拠点パスワードの変更**セクション：
   - **新パスワード**：ユーザーパスワードを変更する場合に入力
   - **新管理者PW**：管理者パスワードを変更する場合に入力
   - **両方とも入力**：両方のパスワードを同時に変更できます
3. 「更新」ボタンをクリック
4. 成功すると「パスワードを更新しました」というメッセージが表示されます

### 注意事項
- 少なくとも1つのパスワードを入力する必要があります
- パスワードは**平文**でサーバーに保存されます（Apps Scriptの仕様上）
- **強固なパスワード**を使用してください
- パスワード変更後、既にログイン中のユーザーは1時間まで有効です
- 新しいログインには新しいパスワードが必要になります

---

## メニュー設定（JSON）

### 用途
以下の設定を変更できます：
- ステータスの種類と色
- 備考の候補リスト
- 業務時間の候補リスト
- 戻り時間の刻み（分単位）

### 操作手順

#### 1. 現在の設定を読み込む
1. 管理パネルを開く
2. **メニュー設定（JSON）**セクションの「現在の設定を読み込み」ボタンをクリック
3. テキストエリアに現在の設定がJSON形式で表示されます

#### 2. 設定を編集する
テキストエリアのJSONを編集します（後述の形式を参照）

#### 3. 設定を保存する
1. 「保存」ボタンをクリック
2. 成功すると「メニュー設定を保存しました」というメッセージが表示されます
3. 画面が自動的に再描画され、新しい設定が反映されます

### JSON形式

#### 基本構造
```json
{
  "statuses": [ ... ],
  "noteOptions": [ ... ],
  "businessHours": [ ... ],
  "timeStepMinutes": 30
}
```

#### statuses（ステータス設定）
各ステータスは以下の形式で定義します：

```json
{
  "value": "ステータス名",
  "class": "CSSクラス名",
  "requireTime": true または false,
  "clearOnSet": true または false
}
```

**プロパティの説明**：

| プロパティ | 必須 | 説明 | 例 |
|------------|------|------|-----|
| value | ✓ | ステータスの表示名 | "外出" |
| class | ✓ | 色分けのためのCSSクラス | "st-out" |
| requireTime | - | 戻り時間を必須にする | true |
| clearOnSet | - | 選択時に戻り時間・備考をクリア | true |

**利用可能なCSSクラス**：

| クラス名 | 色 | 用途 |
|----------|-----|------|
| st-here | 無色（白） | 在席 |
| st-out | オレンジ | 外出 |
| st-meeting | 青 | 会議 |
| st-remote | 紫 | テレワーク、在宅勤務 |
| st-trip | 水色 | 出張 |
| st-training | 緑 | 研修 |
| st-health | ピンク | 健康診断 |
| st-coadoc | 薄紫 | コアドック |
| st-home | 薄灰 | 帰宅 |
| st-off | 赤 | 休み |

**デフォルト設定例**：
```json
{
  "statuses": [
    { "value": "在席",       "class": "st-here",     "clearOnSet": true  },
    { "value": "外出",       "class": "st-out",      "requireTime": true },
    { "value": "在宅勤務",   "class": "st-remote",   "clearOnSet": true  },
    { "value": "出張",       "class": "st-trip",     "requireTime": true },
    { "value": "研修",       "class": "st-training", "requireTime": true },
    { "value": "健康診断",   "class": "st-health",   "requireTime": true },
    { "value": "コアドック", "class": "st-coadoc",   "requireTime": true },
    { "value": "帰宅",       "class": "st-home",     "clearOnSet": true  },
    { "value": "休み",       "class": "st-off",      "clearOnSet": true  }
  ]
}
```

#### noteOptions（備考の候補リスト）
文字列の配列として定義します：

```json
{
  "noteOptions": ["直出", "直帰", "直出・直帰"]
}
```

- ユーザーが備考欄をクリックすると、これらの候補が表示されます
- 任意の候補を追加・削除できます
- 空配列にすると候補が表示されません

#### businessHours（業務時間の候補リスト）
文字列の配列として定義します：

```json
{
  "businessHours": [
    "07:00-15:30",
    "07:30-16:00",
    "08:00-16:30",
    "08:30-17:00",
    "09:00-17:30",
    "09:30-18:00",
    "10:00-18:30",
    "10:30-19:00",
    "11:00-19:30",
    "11:30-20:00",
    "12:00-20:30"
  ]
}
```

- ユーザーが業務時間欄をクリックすると、これらの候補が表示されます
- フォーマット：`HH:MM-HH:MM`
- 任意の時間帯を追加・削除できます
- 空配列にすると候補が表示されません

**互換性**：以下の旧キー名も認識されます：
- `workHourOptions`
- `workHoursOptions`

#### timeStepMinutes（戻り時間の刻み）
戻り時間のドロップダウンに表示される時刻の刻み（分単位）を指定します：

```json
{
  "timeStepMinutes": 30
}
```

- **デフォルト**：30（30分刻み）
- **範囲**：5〜60
- 例：`timeStepMinutes: 15` にすると、15分刻みで表示されます
- 戻り時間の範囲は常に07:00〜22:00です

### 設定例

#### 例1：シンプルな設定
```json
{
  "statuses": [
    { "value": "在席", "class": "st-here", "clearOnSet": true },
    { "value": "外出", "class": "st-out", "requireTime": true },
    { "value": "休み", "class": "st-off", "clearOnSet": true }
  ],
  "noteOptions": ["直出", "直帰"],
  "businessHours": [
    "09:00-17:30",
    "09:00-18:00",
    "10:00-19:00"
  ],
  "timeStepMinutes": 30
}
```

#### 例2：15分刻み、ステータス多め
```json
{
  "statuses": [
    { "value": "在席", "class": "st-here", "clearOnSet": true },
    { "value": "外出", "class": "st-out", "requireTime": true },
    { "value": "会議", "class": "st-meeting", "requireTime": true },
    { "value": "客先", "class": "st-trip", "requireTime": true },
    { "value": "昼休み", "class": "st-here", "requireTime": true },
    { "value": "テレワーク", "class": "st-remote", "clearOnSet": true },
    { "value": "帰宅", "class": "st-home", "clearOnSet": true },
    { "value": "休み", "class": "st-off", "clearOnSet": true }
  ],
  "noteOptions": ["直出", "直帰", "直出・直帰", "半休"],
  "businessHours": [
    "08:00-17:00",
    "09:00-18:00",
    "10:00-19:00",
    "11:00-20:00"
  ],
  "timeStepMinutes": 15
}
```

### 注意事項
- **JSON形式が不正**な場合、「JSONの形式が不正です」というエラーが表示されます
- 設定変更は即座に反映されます
- 既存のステータス値と新しい設定が異なる場合、表示が正しくなくなることがあります
  - 例：「会議」というステータスを削除すると、既に「会議」が設定されているメンバーの表示が崩れます
- **ステータスの削除・変更は慎重に**行ってください

---

## 運用上の注意事項

### 1. バックアップ
- 重要な操作の前には必ず**CSVエクスポート**でバックアップを取ってください
- 特にCSVインポート前は必須です
- 定期的にバックアップを取ることを推奨します

### 2. パスワード管理
- パスワードは**平文**で保存されます（Apps Scriptの仕様）
- 強固なパスワードを使用してください
- パスワードを関係者以外に漏らさないでください
- 定期的にパスワードを変更することを推奨します

### 3. 名簿の更新
- CSVインポートは**名簿全体を置き換えます**
- 部分的な更新はできません
- 必ず現在のデータをエクスポート→編集→インポートの手順で行ってください

### 4. ステータス設定の変更
- ステータスを削除・変更すると、既存データの表示に影響します
- 運用中のステータス変更は避け、追加のみにすることを推奨します
- どうしても変更が必要な場合は、全ユーザーに事前通知してください

### 5. 競合の回避
- 複数の管理者が同時に管理操作を行うと、データが競合する可能性があります
- 管理操作は1人ずつ行うようにしてください

### 6. データの互換性
- 業務時間列がないCSVをインポートすると、既存の業務時間が引き継がれます
- IDが一致しない場合、新しいメンバーとして扱われます
- メンバーの順序を変更したい場合は、「表示順」列を編集してください

### 7. ブラウザキャッシュ
- 設定変更後、ユーザーのブラウザに古いキャッシュが残ることがあります
- 問題が発生した場合、ユーザーにページの再読み込み（Ctrl+Shift+R）を依頼してください

---

## トラブルシューティング

### Q1. CSVインポートで「CSVヘッダが不正です」というエラーが出る
**A**：以下を確認してください：
- 1行目がヘッダー行になっているか
- ヘッダーの形式が正しいか（日本語または英語）
- 列の順序が正しいか
- ファイルがUTF-8またはShift-JISで保存されているか

**正しいヘッダー例**：
```
グループ番号,グループ名,表示順,id,氏名,内線,業務時間,ステータス,戻り時間,備考
```

### Q2. CSVインポート後、メンバーが重複している
**A**：
- 同じメンバーが複数のグループに登録されている可能性があります
- CSVを確認し、重複行を削除してから再インポートしてください

### Q3. メニュー設定を保存したら「JSONの形式が不正です」と表示される
**A**：
- JSON形式が間違っています
- オンラインのJSONバリデーターで確認してください（例：https://jsonlint.com/）
- 以下をチェック：
  - カンマの位置は正しいか
  - 括弧（`{}`、`[]`）は対応しているか
  - ダブルクォート（`"`）で文字列を囲んでいるか
  - 最後の項目の後にカンマがないか

### Q4. ステータスの色が表示されない
**A**：
- `class` プロパティが正しいCSSクラス名か確認してください
- 利用可能なクラス名のリストを参照してください（上記参照）
- カスタムクラスは現在サポートされていません

### Q5. 拠点名を変更したのに反映されない
**A**：
- 画面を再読み込みしてください（F5キーまたはブラウザの更新ボタン）
- 他のユーザーは次回ログイン時に反映されます

### Q6. パスワードを変更したらログインできなくなった
**A**：
- **ユーザーパスワード**と**管理者パスワード**は別物です
- 管理者としてログインする場合は、管理者パスワードを使用してください
- パスワードを忘れた場合、スーパー管理者に連絡してください

### Q7. CSVエクスポートしたファイルをExcelで開くと文字化けする
**A**：
- ファイルはUTF-8（BOM付き）で出力されており、通常は文字化けしません
- 文字化けする場合：
  1. Excelで「データ」→「テキストファイル」→「インポート」を選択
  2. 文字コードを「UTF-8」に設定してインポート

### Q8. 大量のデータをインポートしたら時間がかかる
**A**：
- 100件以上のデータは自動的に分割処理されます
- 処理には時間がかかることがありますが、正常です
- 処理中はブラウザを閉じないでください

### Q9. 管理パネルが開かない
**A**：
- 管理者権限でログインしているか確認してください
- 一般ユーザーパスワードでログインすると、「管理」ボタンは表示されません
- 一度ログアウトして、管理者パスワードで再ログインしてください

### Q10. 誤ってメンバーを削除してしまった
**A**：
- 削除前のバックアップ（CSVエクスポート）があれば、それを再インポートしてください
- バックアップがない場合は、手動でCSVを作成して再インポートする必要があります
- 今後は重要な操作の前に必ずバックアップを取ってください

### Q11. イベントのガントチャートが表示されません
**A**：
- 開始日と終了日を両方入力していることを確認してください
- 日付が未入力の場合、ガントチャートは生成されません
- ページを再読み込み（F5）して再度試してみてください

### Q12. イベントを保存したのにユーザーに表示されない
**A**：
- 「表示する」チェックボックスがONになっているか確認してください
- チェックOFFの場合、管理者のみ閲覧可能でユーザーには表示されません
- 「登録済みのイベント」一覧でチェックボックスを確認してください

### Q13. イベントのガントチャートでセルがクリックできません
**A**：
- ブラウザのJavaScriptが有効になっているか確認してください
- ページを再読み込み（F5）して再度試してみてください
- 別のブラウザ（Chrome、Edge、Safariなど）を試してください

### Q14. イベントの期間を変更したい
**A**：
- 「登録済みのイベント」一覧から該当の休暇の「編集」ボタンをクリック
- 開始日と終了日を変更してください
- 期間を変更すると、ガントチャートが再生成されます
- メンバー指定も再度設定し直す必要がある場合があります

### Q15. イベントを表示しているユーザーがステータスを変更できない
**A**：
- これは正常な動作です
- イベント表示中は、該当メンバーのステータスは「休み」に固定されます
- ユーザーに「表示クリア」を依頼してください
- または、管理者がイベントの「表示」をOFFにしてください

### Q16. イベントの表示順序を変更したい
**A**：
- 現在、イベントの表示順序を変更する機能はありません
- 登録された順序で表示されます
- 順序を変えたい場合は、一度削除して再度作成してください

---

## 補足：開発・保守担当者向け

管理者機能はフロントエンド（`js/admin.js`）とバックエンド（GAS）で実装されています。

### 関連ファイル
- `js/admin.js`：管理パネルのUI処理
- `GAS_コード.gs`：サーバー側API
- `GAS_admin_super.gs`：スーパー管理者のパスワード管理

### API一覧
- `listOffices`：拠点一覧取得
- `getFor`：指定拠点のデータ取得
- `getConfigFor`：指定拠点の設定取得
- `setFor`：指定拠点のデータ更新
- `setConfigFor`：指定拠点の設定更新
- `renameOffice`：拠点名変更
- `setOfficePassword`：パスワード変更

詳細は `README.md` を参照してください。
